<!DOCTYPE html>
<html>
<head>
  <title>Simple Accept.js Payment Form</title>
</head>
<body>

<script type="text/javascript" src="https://jstest.authorize.net/v1/Accept.js" charset="utf-8"></script>

<form id="paymentForm">
  <input type="text" id="cardNumber" placeholder="Card Number" /><br><br>
  <input type="text" id="expMonth" placeholder="Exp Month (MM)" /><br><br>
  <input type="text" id="expYear" placeholder="Exp Year (YY)" /><br><br>
  <input type="text" id="cardCode" placeholder="CVV" /><br><br>
  <input type="text" id="email" placeholder="Email (optional)" /><br><br>
  <input type="text" id="fullName" placeholder="Full Name (optional)" /><br><br>
  <input type="text" id="phone" placeholder="Phone (optional)" /><br><br>

  <input type="hidden" id="dataValue" />
  <input type="hidden" id="dataDescriptor" />

  <button type="button" onclick="sendPaymentDataToAnet()">Pay</button>
</form>

<script type="text/javascript">
  function sendPaymentDataToAnet() {
    const authData = {
      clientKey: "2db4sy8RBUHK3nFW7y6aSK6Ae3WC9TQ6f4vWh3ynN78yrpMjjbQ52X5vz5MA3Zf9",
      apiLoginID: "4625ksJLu"
    };

    const cardData = {
      cardNumber: document.getElementById("cardNumber").value,
      month: document.getElementById("expMonth").value,
      year: document.getElementById("expYear").value,
      cardCode: document.getElementById("cardCode").value
    };

    const secureData = {
      authData,
      cardData
    };

    Accept.dispatchData(secureData, function(response) {
      if (response.messages.resultCode === "Error") {
        alert("Error: " + response.messages.message[0].text);
      } else {
        const opaqueData = response.opaqueData;

        document.getElementById("dataDescriptor").value = opaqueData.dataDescriptor;
        document.getElementById("dataValue").value = opaqueData.dataValue;

        // Clear sensitive info from UI
        document.getElementById("cardNumber").value = "";
        document.getElementById("expMonth").value = "";
        document.getElementById("expYear").value = "";
        document.getElementById("cardCode").value = "";

        // Send to backend
        fetch("https://update-payment.onrender.com/save-payment.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            dataDescriptor: opaqueData.dataDescriptor,
            dataValue: opaqueData.dataValue,
            fullName: document.getElementById("fullName").value,
            email: document.getElementById("email").value,
            phone: document.getElementById("phone").value
          })
        })
        .then(res => res.json())
        .then(data => {
          console.log("Server response:", data);
          if (data.error) {
            alert("Server Error: " + data.error);
          } else {
            alert("Payment info saved successfully!");
          }
        });
      }
    });
  }
</script>

</body>
</html>
